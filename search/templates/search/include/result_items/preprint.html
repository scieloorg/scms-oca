{% load humanize %}
{% load static %}
{% load i18n %}
{% load wagtailsettings_tags %}
{% load wagtailcore_tags %}
{% load custom_filters %}

{% get_localized_field doc.source "title" as display_title %}
{% get_localized_field doc.source "abstract" as display_abstract %}
{% get_localized_field doc.source "subjects" "list" as display_subjects %}


<div class="d-flex justify-content-between align-items-start gap-2">
    <h5 class="card-title mb-0" style="flex: 1 1 auto; min-width: 0;">
    {% if doc.source.ids.doi %}
        <a href="https://doi.org/{{ doc.source.ids.doi }}" target="_blank" class="text-decoration-none">
            {{ display_title }}
        </a>
    {% elif doc.source.content_url %}
        <a href="{{ doc.source.content_url }}" target="_blank" class="text-decoration-none">
            {{ display_title }}
        </a>
    {% else %}
        <a href="{{pageurl}}" target="_blank" class="text-decoration-none">{{ display_title }}</a>
    {% endif %}
    </h5>
    {% if doc.source.type %}
        <span class="badge bg-secondary ms-2 text-muted" style="flex-shrink: 0; white-space: nowrap;">{{ doc.source.type }}</span>
    {% endif %}
</div>

{% if doc.source.authorships %}
    <p class="card-text">
        {% for author in doc.source.authorships %}
            {{ author.name }}{% if author.orcid %} <a href="{{ author.orcid }}" target="_blank"><img src="{% static 'images/authorIcon-orcid.png' %}" alt="ORCID"></a>{% endif %}{% if not forloop.last %}; {% endif %}
        {% endfor %}
    </p>
{% endif %}

{% if display_abstract %}
<p class="card-text">
    {{ display_abstract|safe }}
</p>
{% endif %}

{% if doc.source.publisher %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "Publisher" %}:</strong>
        {{ doc.source.publisher }}
    </small>
</p>
{% endif %}

{% if doc.source.publication_year %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "Year" %}:</strong> {{ doc.source.publication_year }}
    </small>
</p>
{% endif %}

{% if doc.source.publication_date %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "Publication Date" %}:</strong> {{ doc.source.publication_date }}
    </small>
</p>
{% endif %}

{% if doc.source.language %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "Language" %}:</strong>
        {% if doc.source.language|length > 4 %}
            {% for language in doc.source.language %}
                {{ language }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
        {% else %}
            {{ doc.source.language }}
        {% endif %}
    </small>
</p>
{% endif %}

{% if display_subjects %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "Subjects" %}:</strong>
        {% for subject in display_subjects %}
            {{ subject }}{% if not forloop.last %}, {% endif %}
        {% endfor %}
    </small>
</p>
{% endif %}

{% if doc.source.ids.doi %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "DOI" %}:</strong>
        <a href="https://doi.org/{{ doc.source.ids.doi }}" target="_blank">
            {{ doc.source.ids.doi }}
        </a>
    </small>
</p>
{% endif %}

{% if doc.source.ids.scl_preprint_id %}
<p class="card-text mb-1">
    <small class="text-muted">
        <strong>{% trans "SciELO Preprint ID" %}:</strong> {{ doc.source.ids.scl_preprint_id }}
    </small>
</p>
{% endif %}

{% if doc.source.rights %}
<p class="card-text mb-0">
    <small class="text-muted">
        <strong>{% trans "Rights" %}:</strong>
        {% for right in doc.source.rights %}
            {{ right }}{% if not forloop.last %}; {% endif %}
        {% endfor %}
    </small>
</p>
{% endif %}

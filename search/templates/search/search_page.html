{% extends "search/search.html" %}
{% load custom_filters %}
{% load static %}
{% load i18n %}

{% block header_content %}
<div class="search-header-card">
    <h1 class="search-header-card__title">{% trans display_name %}</h1>
    <span class="search-header-card__subtitle">{% if index_name == 'sci*' %}{% trans 'articles, preprints, datasets, books' %}...{% else %}{% trans 'Actions, events and infrastructure' %}{% endif %}</span>
    <form method="get" action="{{self}}" id="search-form" class="search-header-card__search">
        <div class="search-input-card__row">
            <input
                type="search"
                name="search"
                id="search-input"
                class="search-input-card__input"
                placeholder="{% trans 'Search' %} {% if index_name == 'sci*' %}{% trans 'articles, preprints, datasets, books' %}...{% else %}{% trans 'Actions, events and infrastructure' %}{% endif %}"
                value="{{ search_query }}"
                autocomplete="off"
            >
            <button type="submit" class="btn btn-primary search-input-card__button">
                {% trans "Buscar" %}
            </button>
        </div>
    </form>
</div>
{% endblock%}

{% block search_sidebar %}
    {% include "search/include/filters.html" %}
{% endblock %}

{% block search_content %}
    <div class="card mb-3 p-3 d-none shadow-sm indicator-applied-filters" id="active-filters-container">
        <div class="applied-filters-head">
            <span class="applied-filters-title">{% trans "Filtros aplicados" %}</span>
            <span class="applied-filters-count" id="active-filters-count">0</span>
        </div>

        <div id="search-query-section" class="mb-2 d-none">
            <span class="applied-filters-grid" id="search-query-badge"></span>
        </div>

        <div id="filters-section" class="d-none">
            <div class="applied-filters-grid" id="selected-filters-badges"></div>
        </div>
    </div>

    {% include "search/include/results.html" %}
{% endblock %}

{% block javascript %}
{{ block.super }}
{{ filters|json_script:"filters-data" }}
{{ filter_metadata|json_script:"filter-metadata-data" }}
<script src="{% static 'search/js/search_page.js' %}"></script>
<link href="{% static 'search/css/custom.css' %}" rel="stylesheet">
<script>
    window.searchPageConfig = {
        initialSearchQuery: '{{ search_query|escapejs }}',
        dataSourceName: '{{ index_name|escapejs }}',
        filters: JSON.parse(document.getElementById('filters-data').textContent),
        filterMetadata: JSON.parse(document.getElementById('filter-metadata-data').textContent),
    };
</script>
{% endblock %}

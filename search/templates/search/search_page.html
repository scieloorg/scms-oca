{% extends "search/search.html" %}
{% load custom_filters %}
{% load static %}

{% block header_content %}
    <div class="row mx-1">
        <div class="card mb-2 p-3 bg-light shadow-sm">
        <div class="page-title-content">
            <h1 class="mb-1">Search</h1>
            <span class="text-muted">Data of the OCABr Observatory</span>
        </div>
        </div>
    </div>

    <div class="row mx-1">
    <div class="card mb-2 p-3 bg-light shadow-sm">
        <h4 style="margin-bottom: 2%;">Data Source</h4>
        <select id="data-source-select" class="form-select" aria-label="Data Source">
            {% for ds in available_data_sources %}
                <option value="{{ ds.key }}" {% if ds.key == data_source_name %}selected{% endif %}>
                    {{ ds.display_name }}
                </option>
            {% endfor %}
        </select>
    </div>
    </div>
{% endblock%}

{% block search_sidebar %}
    {% include "search/include/filters.html" %}
{% endblock %}

{% block search_content %}
    <div class="card mb-3 p-3 bg-white shadow-sm">
        <form method="get" action="{{self}}" id="search-form">
            <div class="row g-2 align-items-end">
                <div class="col-md-10">
                    <label for="search-input" class="form-label">
                        <i class="icon-search"></i> Buscar
                    </label>
                    <input 
                        type="search" 
                        name="search" 
                        id="search-input" 
                        class="form-control" 
                        placeholder="Digite sua pesquisa..." 
                        value="{{ search_query }}"
                        autocomplete="off"
                    >
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100" style="padding-bottom: 0% !important; margin-bottom: 0% !important; text-align: center;">
                        Buscar
                    </button>
                </div>
            </div>
        </form>
        
        <div id="search-query-container" class="mt-3 pt-2 border-top" {% if not search_query %}style="display: none;"{% endif %}>
            <small class="text-muted">
                <span id="search-query-badge" class="badge bg-info">Busca: "{{ search_query }}"</span>
            </small>
        </div>
    </div>
    {% include "search/include/results.html" %}
{% endblock %}

{% block javascript %}
{{ block.super }}
{{ filters|json_script:"filters-data" }}
{{ filter_metadata|json_script:"filter-metadata-data" }}
<script src="{% static 'search/js/search_page.js' %}"></script>
<script>
    window.searchPageConfig = {
        initialSearchQuery: '{{ search_query|escapejs }}',
        dataSourceName: '{{ data_source_name }}',
        filters: JSON.parse(document.getElementById('filters-data').textContent),
        filterMetadata: JSON.parse(document.getElementById('filter-metadata-data').textContent),
    };
</script>
{% endblock %}
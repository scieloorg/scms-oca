{% extends "search/search.html" %}
{% load custom_filters %}
{% load static %}

{% block header_content %}
    <div class="row">
        <div class="col-12" style="padding-right: 0% !important;">
            <div class="card mb-2 p-3 bg-oca-light shadow-sm">
                <div class="page-title-content">
                    <h1 class="mb-1 fw-bold text-oca-blue-title">{{ display_name }}</h1>
                    <span class="text-muted">Data of the OCABr Observatory</span>
                </div>
            </div>
        </div>
    </div>
{% endblock%}

{% block search_sidebar %}
    {% include "search/include/filters.html" %}
{% endblock %}

{% block search_content %}
    <div class="card mb-3 p-3 bg-white shadow-sm">
        <form method="get" action="{{self}}" id="search-form">
            <div class="row g-2 align-items-end">
                <div class="col-md-10">
                    <label for="search-input" class="form-label">
                        <i class="icon-search"></i> Buscar
                    </label>
                    <input 
                        type="search" 
                        name="search" 
                        id="search-input" 
                        class="form-control" 
                        placeholder="Digite sua pesquisa..." 
                        value="{{ search_query }}"
                        autocomplete="off"
                    >
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100" style="padding-bottom: 0% !important; margin-bottom: 0% !important; text-align: center;">
                        Buscar
                    </button>
                </div>
            </div>
        </form>
        
        <div id="active-filters-container" class="mt-3 pt-2 border-top" style="display: none;">
            <!-- Search Query Section -->
            <div id="search-query-section" class="mb-2" style="display: none;">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <small class="text-muted me-2"><strong>Busca:</strong></small>
                    <span id="search-query-badge" class="badge bg-info" style="font-size: 0.9rem;">
                        <!-- Search badge will be populated by JavaScript -->
                    </span>
                </div>
            </div>
            
            <!-- Filters Section -->
            <div id="filters-section" style="display: none;">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <small class="text-muted me-2"><strong>Filtros ativos:</strong></small>
                    <div id="selected-filters-badges" class="d-flex flex-wrap gap-2">
                        <!-- Filter badges will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include "search/include/results.html" %}
{% endblock %}

{% block javascript %}
{{ block.super }}
{{ filters|json_script:"filters-data" }}
{{ filter_metadata|json_script:"filter-metadata-data" }}
<script src="{% static 'search/js/search_page.js' %}"></script>
<script>
    window.searchPageConfig = {
        initialSearchQuery: '{{ search_query|escapejs }}',
        dataSourceName: '{{ data_source_name }}',
        filters: JSON.parse(document.getElementById('filters-data').textContent),
        filterMetadata: JSON.parse(document.getElementById('filter-metadata-data').textContent),
    };
    
</script>
{% endblock %}
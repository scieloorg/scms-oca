{% if study_unit != 'journal' %}
<h4 class="my-2">Graph Options</h4>

<div class="form-group mb-3">
    <label for="breakdown_variable" class="form-label">Breakdown Variable</label>
    <select id="breakdown_variable" name="breakdown_variable" class="form-control">
        <option></option>
        <option value="collection">Collection</option>
        <option value="document_language">Document Language</option>
        <option value="access_type">Access Type</option>
    </select>
</div>
{% endif %}

<h4 class="my-2 pt-1">Filters</h4>

<div class="form-group mb-3">
    <label class="form-label" for="collection">Collection</label>
    <div class="input-group">
        <div class="flex-grow-1 position-relative input-group-left">
            <select id="collection" name="collection" class="form-control" aria-label="Collection">
                <option></option>
                <option value="arg">Argentina</option>
                <option value="bol">Bolivia</option>
                <option value="scl">Brazil</option>
                <option value="chl">Chile</option>
                <option value="col">Colombia</option>
                <option value="cri">Costa Rica</option>
                <option value="cub">Cuba</option>
                <option value="dom">Dominican Republic</option>
                <option value="ecu">Ecuador</option>
                <option value="mex">Mexico</option>
                <option value="per">Peru</option>
                <option value="prt">Portugal</option>
                <option value="pry">Paraguay</option>
                <option value="esp">Spain</option>
                <option value="sza">South Africa</option>
                <option value="ury">Uruguay</option>
                <option value="ven">Venezuela</option>
                <option value="wid">West Indies</option>
                <option value="cic">Science and Culture</option>
                <option value="psi">PEPSIC</option>
                <option value="spa">Public Health</option>
                <option value="rve">REVENF</option>
            </select>
        </div>
        <button aria-pressed="false" class="btn btn-outline input-group-right toggle-not" type="button" id="collection_bool_not" title="Click to activate not operator">NOT</button>
    </div>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="publisher">Publisher</label>
    <div class="input-group">
        <div class="flex-grow-1 position-relative input-group-left">
            <select id="publisher" name="publisher" class="form-control" aria-label="Publisher"></select>
        </div>
        <button aria-pressed="false" class="btn btn-outline input-group-right toggle-not" type="button" id="publisher_bool_not" title="Click to activate not operator">NOT</button>
    </div>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="journal">Journal</label>
    <div class="input-group">
        <div class="flex-grow-1 position-relative input-group-left">
            <select id="journal" name="journal" class="form-control" aria-label="Journal"></select>
        </div>
        <button aria-pressed="false" class="btn btn-outline input-group-right toggle-not" type="button" id="journal_bool_not" title="Click to activate not operator">NOT</button>
    </div>
</div>

<div class="h6 pb-2 mt-4 border-bottom text-primary">
  <strong>Document</strong>
</div>

<div class="form-group mb-3">
  <label class="form-label" for="document_publication_year_start">Publication Year</label>
  <div class="input-group">
    <input
      id="document_publication_year_start"
      name="document_publication_year_start"
      type="text"
      class="form-control is-height-2-4"
      aria-label="Publication Year Start"
      placeholder="Start"
      value="2015"
    />
    <input
      id="document_publication_year_end"
      name="document_publication_year_end"
      type="text"
      class="form-control is-height-2-4"
      aria-label="Publication Year End"
      placeholder="End"
      value="2024"
    />
  </div>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="document_type">Document Type</label>
    <select multiple id="document_type" name="document_type" class="form-control" aria-label="Type"></select>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="document_language">Document Language</label>
    <div class="d-flex align-items-start justify-content-between">
        <div class="select-left flex-grow-1">
            <select multiple id="document_language" name="document_language" class="form-control" aria-label="Language"></select>
        </div>
        <div class="select-right">
            <select id="document_language_operator" name="document_language_operator" class="form-control" aria-label="Language Query Operator">
                <option value="and" selected>AND</option>
                <option value="or">OR</option>
            </select>
        </div>
    </div>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="access_type">Access Type</label>
    <select multiple id="access_type" name="access_type" class="form-control" aria-label="Access Type"></select>
</div>

<div class="h6 pb-2 mt-4 border-bottom text-primary">
  <strong>Author Affiliation</strong>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="institution">Institution</label>
    <select multiple id="institution" name="institution" class="form-control" aria-label="Institution"></select>
</div>

<div class="form-group mb-3">
    <label class="form-label" for="country">Country</label>
    <div class="d-flex align-items-start justify-content-between">
        <div class="select-left flex-grow-1">
           <select multiple id="country" name="country" class="form-control" aria-label="Country"></select>
        </div>
        <div class="select-right">
            <select id="country_operator" name="country_operator" class="form-control" aria-label="Country Query Operator">
                <option value="and" selected>AND</option>
                <option value="or">OR</option>
            </select>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    try {
        // Populate filters
        const data = await fetchFilters('scielo');
        populateSelectFilters(
            // Filters data retrieved from the index API
            data,
            // Fields that we don't want to populate because they are handled differently
            [
              'breakdown_variable',
              'collection',
              'country_operator',
              'document_language_operator',
              'document_publication_year_end',
              'document_publication_year_start',
              'institution',
              'journal',
              'publisher',
            ]
        );
    } catch (error) {
        console.error('Error loading filters', error);
    }

    // Initialize datepicker fields
    const yearFields = [
        'document_publication_year_start',
        'document_publication_year_end',
    ];
    yearFields.forEach(fieldId => {
        setupDatePicker(fieldId);
    });

    // Initialize singleselect fields
    const singleSelectFieldsOpts = [
        ["access_type", "Select an access type", false, true],
        ["breakdown_variable", "Select a breakdown variable", false, true],
        ["collection", "Select a collection", false, true],
        ["country_operator", "", false, false],
        ["document_language_operator", "", false, false],
        ["document_type", "Select a document type", false, true],
    ]
    singleSelectFieldsOpts.forEach(([fieldId, fieldPlaceholder, allowSearch, allowClear]) => {
        setupSelect2Single(fieldId, fieldPlaceholder, allowSearch, allowClear);
    });

    // Initialize multiselect fields with boolean operators
    const multiSelectFieldsOpts = [
        ["country", "Search for a country", false],
        ["document_language", "Search for a language", false],
    ];
    multiSelectFieldsOpts.forEach(([fieldId, fieldPlaceholder, allowClear]) => {
        setupSelect2Multiple(fieldId, fieldPlaceholder, allowClear);
    });
});
</script>
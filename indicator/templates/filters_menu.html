{# filters_menu.html - Filters Menu for Indicators #}
<h4 style="margin: 0; padding-top: 0.5em; padding-bottom: 0.5em;">Filters</h4>
<div id="filters-menu" class="filters-menu">
  <form id="filters-form" class="mb-4">
    <div>
      <label for="publication_year">Publication Year</label>
      <select id="publication_year" name="publication_year" class="form-control" multiple></select>
    </div>

    <div>
      <label for="source_type">Source Type</label>
      <select id="source_type" name="source_type" class="form-control" multiple></select>
    </div>
    
    <div>
      <label for="source_index">Source Index</label>
      <select id="source_index" name="source_index" class="form-control" multiple></select>
    </div>
    
    <div>
      <label for="document_type">Document Type</label>
      <select id="document_type" name="document_type" class="form-control" multiple></select>
    </div>
    
    <div>
      <label for="open_access">Open Access</label>
      <select id="open_access" name="open_access" class="form-control">
        <option value="">All</option>
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>
    </div>
    
    <div>
      <label for="open_access_type">Open Access Type</label>
      <select id="open_access_type" name="open_access_type" class="form-control" multiple></select>
    </div>
        
    <div>
      <label for="thematic_area_level_0">Thematic Area Level 0</label>
      <select id="thematic_area_level_0" name="thematic_area_level_0" class="form-control" multiple></select>
    </div>

    <div>
      <label for="thematic_area_level_1">Thematic Area Level 1</label>
      <select id="thematic_area_level_1" name="thematic_area_level_1" class="form-control" multiple></select>
    </div>

    <div>
      <label for="thematic_area_level_2">Thematic Area Level 2</label>
      <select id="thematic_area_level_2" name="thematic_area_level_2" class="form-control" multiple></select>
    </div>
    
    <div>
      <label for="country">Country</label>
      <select id="country" name="country" class="form-control" multiple></select>
    </div>

    <div style="margin-top: 1em;">
      <button type="submit" class="btn btn-primary">Generate Graph</button>
    </div>
  </form>
</div>

<script>

document.addEventListener('DOMContentLoaded', function() {
  fetch('/indicators/filters/')
    .then(response => response.json())
    .then(data => {
      for (const [key, values] of Object.entries(data)) {
        const select = document.getElementById(key);
        if (select) {
          select.innerHTML = '';
          values.forEach(v => {
            const opt = document.createElement('option');
            opt.value = v;
            opt.textContent = v;
            select.appendChild(opt);
          });
        }
      }
    });

  document.getElementById('filters-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const filters = {};
    for (const [key, value] of formData.entries()) {
      if (filters[key]) {
        if (Array.isArray(filters[key])) {
          filters[key].push(value);
        } else {
          filters[key] = [filters[key], value];
        }
      } else {
        filters[key] = value;
      }
    }
    fetch('/indicators/indicators/', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(filters)
    })
    .then(response => response.json())
    .then(data => {
      console.log(data);
      if (typeof renderChart === 'function') {
        renderChart(data);
      }
    });
  });
});
</script>
